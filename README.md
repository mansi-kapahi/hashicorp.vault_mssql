# Vault MSSQL Database setup 

This test demonstrate lease creation and revocation on Vault with Microsoft SQL Server.

## Usage & Workflow
Refer to the contents of **`Vagrantfile`** for complete details.

```bash
vagrant up --provider virtualbox ;
# // … output of provisioning steps.

vagrant global-status ; # should show running nodes
  # id       name         provider    state    directory
  # ----------------------------------------------------------------------------------------------
  # 6c90677  hsm1-vault1  virtualbox  running  /home/auser/hashicorp.vault_mssql


vagrant ssh hsm1-vault1 ;  # // On a separate Terminal promote vault2.
  # ………
#vagrant@hsm1-vault1:~$ \
./vault_revocation_test.sh
  # +-------------------------------------------------------------+----------------+--------+---------------+-----------------------+-------------------------+-------------------------+-----------------------+------------------------------------------------------------+-----------------+-----------------------+----------------------------+-------------------------+-------------------------+---------------------------------------+
  # | name                                                        | principal_id   | type   | type_desc     | default_schema_name   | create_date             | modify_date             | owning_principal_id   | sid                                                        | is_fixed_role   | authentication_type   | authentication_type_desc   | default_language_name   | default_language_lcid   | allow_encrypted_value_modifications   |
  # |-------------------------------------------------------------+----------------+--------+---------------+-----------------------+-------------------------+-------------------------+-----------------------+------------------------------------------------------------+-----------------+-----------------------+----------------------------+-------------------------+-------------------------+---------------------------------------|
  # | public                                                      | 0              | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.317 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000083741B006749C04BA943C02702F2A762 | 0               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | dbo                                                         | 1              | S      | SQL_USER      | dbo                   | 2003-04-08 09:10:42.287 | 2021-10-28 13:04:24.980 | NULL                  | 0x01                                                       | 0               | 1                     | INSTANCE                   | NULL                    | NULL                    | 0                                     |
  # | guest                                                       | 2              | S      | SQL_USER      | guest                 | 2003-04-08 09:10:42.317 | 2003-04-08 09:10:42.317 | NULL                  | 0x00                                                       | 0               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | INFORMATION_SCHEMA                                          | 3              | S      | SQL_USER      | NULL                  | 2009-04-13 12:59:11.717 | 2009-04-13 12:59:11.717 | NULL                  | NULL                                                       | 0               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | sys                                                         | 4              | S      | SQL_USER      | NULL                  | 2009-04-13 12:59:11.717 | 2009-04-13 12:59:11.717 | NULL                  | NULL                                                       | 0               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | v-root-TWGDDBMGDB03_chat_se-ysYWcjMbZAGn0U5dw24f-1635426336 | 5              | S      | SQL_USER      | dbo                   | 2021-10-28 13:05:36.033 | 2021-10-28 13:05:36.033 | NULL                  | 0xCA006A9D2CA59F45AF7436F05E2FFFFE                         | 0               | 1                     | INSTANCE                   | NULL                    | NULL                    | 0                                     |
  # | v-root-TWGDDBMGDB03_chat_se-jAlU9FZHm81zXhxONC5j-1635426336 | 6              | S      | SQL_USER      | dbo                   | 2021-10-28 13:05:36.197 | 2021-10-28 13:05:36.197 | NULL                  | 0x049B5E97DB53E74BB80B554B78148EB2                         | 0               | 1                     | INSTANCE                   | NULL                    | NULL                    | 0                                     |
  # | v-root-TWGDDBMGDB03_chat_se-avXRRhim9gY9Xb2U4U8a-1635426336 | 7              | S      | SQL_USER      | dbo                   | 2021-10-28 13:05:36.330 | 2021-10-28 13:05:36.330 | NULL                  | 0x5834443D11BF8F49BB8FD9C239F7D455                         | 0               | 1                     | INSTANCE                   | NULL                    | NULL                    | 0                                     |
  # | v-root-TWGDDBMGDB03_chat_se-nqGWdTKRyXrsAu7eJ5tL-1635426336 | 8              | S      | SQL_USER      | dbo                   | 2021-10-28 13:05:36.490 | 2021-10-28 13:05:36.490 | NULL                  | 0x50E8723D4F8FBA4B94D672CBFA51067F                         | 0               | 1                     | INSTANCE                   | NULL                    | NULL                    | 0                                     |
  # | db_owner                                                    | 16384          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.333 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000000400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_accessadmin                                              | 16385          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.333 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000001400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_securityadmin                                            | 16386          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.350 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000002400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_ddladmin                                                 | 16387          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.350 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000003400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_backupoperator                                           | 16389          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.350 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000005400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_datareader                                               | 16390          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.363 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000006400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_datawriter                                               | 16391          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.363 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000007400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_denydatareader                                           | 16392          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.380 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000008400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_denydatawriter                                           | 16393          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.380 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000009400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # +-------------------------------------------------------------+----------------+--------+---------------+-----------------------+-------------------------+-------------------------+-----------------------+------------------------------------------------------------+-----------------+-----------------------+----------------------------+-------------------------+-------------------------+---------------------------------------+
  # (18 rows affected)
  # All revocation operations queued successfully!
  # All revocation operations queued successfully!
  # All revocation operations queued successfully!
  # All revocation operations queued successfully!
  # +--------------------+----------------+--------+---------------+-----------------------+-------------------------+-------------------------+-----------------------+------------------------------------------------------------+-----------------+-----------------------+----------------------------+-------------------------+-------------------------+---------------------------------------+
  # | name               | principal_id   | type   | type_desc     | default_schema_name   | create_date             | modify_date             | owning_principal_id   | sid                                                        | is_fixed_role   | authentication_type   | authentication_type_desc   | default_language_name   | default_language_lcid   | allow_encrypted_value_modifications   |
  # |--------------------+----------------+--------+---------------+-----------------------+-------------------------+-------------------------+-----------------------+------------------------------------------------------------+-----------------+-----------------------+----------------------------+-------------------------+-------------------------+---------------------------------------|
  # | public             | 0              | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.317 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000083741B006749C04BA943C02702F2A762 | 0               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | dbo                | 1              | S      | SQL_USER      | dbo                   | 2003-04-08 09:10:42.287 | 2021-10-28 13:04:24.980 | NULL                  | 0x01                                                       | 0               | 1                     | INSTANCE                   | NULL                    | NULL                    | 0                                     |
  # | guest              | 2              | S      | SQL_USER      | guest                 | 2003-04-08 09:10:42.317 | 2003-04-08 09:10:42.317 | NULL                  | 0x00                                                       | 0               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | INFORMATION_SCHEMA | 3              | S      | SQL_USER      | NULL                  | 2009-04-13 12:59:11.717 | 2009-04-13 12:59:11.717 | NULL                  | NULL                                                       | 0               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | sys                | 4              | S      | SQL_USER      | NULL                  | 2009-04-13 12:59:11.717 | 2009-04-13 12:59:11.717 | NULL                  | NULL                                                       | 0               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_owner           | 16384          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.333 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000000400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_accessadmin     | 16385          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.333 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000001400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_securityadmin   | 16386          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.350 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000002400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_ddladmin        | 16387          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.350 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000003400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_backupoperator  | 16389          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.350 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000005400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_datareader      | 16390          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.363 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000006400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_datawriter      | 16391          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.363 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000007400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_denydatareader  | 16392          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.380 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000008400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # | db_denydatawriter  | 16393          | R      | DATABASE_ROLE | NULL                  | 2003-04-08 09:10:42.380 | 2009-04-13 12:59:14.467 | 1                     | 0x01050000000000090400000000000000000000000000000009400000 | 1               | 0                     | NONE                       | NULL                    | NULL                    | 0                                     |
  # +--------------------+----------------+--------+---------------+-----------------------+-------------------------+-------------------------+-----------------------+------------------------------------------------------------+-----------------+-----------------------+----------------------------+-------------------------+-------------------------+---------------------------------------+
  # (14 rows affected)

# // ---------------------------------------------------------------------------
# when completely done:
vagrant destroy -f hsm1-vault1 ; # ... destroy all - ORDER IMPORTANT
vagrant box remove -f debian/buster64 --provider virtualbox ; # ... delete box images
```



------
